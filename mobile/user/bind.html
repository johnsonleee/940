<!doctype html>
<html>
<head>
    <!--wap-->
    <meta charset="utf-8">
    <!-- width取值与页面定义的宽度一致 -->
    <meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <!-- 百度禁止转码 -->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>940电商学院 - 最专业的淘宝电商培训，店铺运营推广，电商培训领导者</title>
    <!--css-->
    <link rel="stylesheet" type="text/css" href="../user/css/bind.css">
    <link rel="stylesheet" type="text/css" href="../user/css/passw.css">
    <!--js-->
    <script type="text/javascript" src="../scripts/js/jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="../user/js/bind.js"></script>
</head>

<body>

<div class="main">
    <div class="reg-box" id="verifyCheck">
       <form class="verifyCheck" method="post">
           <div class="item col-xs-12">
               <div class="f-fl item-ifo">
                   <input type="text" class="txt03 f-r3 required" keycodes="tel" tabindex="2" data-valid="isNonEmpty||isPhone" data-error="手机号码不能为空||手机号码格式不正确" maxlength="11" id="phone" placeholder="请输入手机号码" />
                   <span class="ie8 icon-close close hide"></span>
                   <label class="icon-sucessfill blank hide"></label>
                   <label class="focus"></label>
                   <label class="focus valid"></label>
               </div>
           </div>

           <div class="register-distance"></div>

           <div class="item col-xs-12">
               <div class="f-fl item-ifo">
                   <input type="text" maxlength="6" id="verifyNo" class="txt04 f-r3 f-fl required" tabindex="4" data-valid="isNonEmpty||isInt" data-error="验证码不能为空||请输入6位数字验证码" placeholder="请输入验证码" />
                   <span class="btn btn-gray f-r3 f-ml5 f-size13" id="time_box" disabled style="width:170px;display:none;">发送验证码</span>
                   <span class="btn btn-gray f-r3 f-ml5 f-size13" id="verifyYz" style="width:170px;">发送验证码</span>
                   <span class="ie8 icon-close close hide" style="right:130px"></span>
                   <label class="icon-sucessfill blank hide"></label>
                   <label class="focus"><span></span></label>
                   <label class="focus valid"></label>
               </div>
           </div>

           <div class="register-distance"></div>

           <div class="item col-xs-12 bind-top">
               <div class="register-controls">
                   <button type="submit" class="btn-long btn-purple" id="submit">确认绑定</button>
               </div>
           </div>
       </form>
    </div>
</div>

<script>
$(function(){
    $("#time_box").click(function () {
        fsyzm();
    });
    var modify = $.param({
        /* user_name: $(".passw-form .username").text(),*/
        phone:$("#phone").val(),
        code: $(".verifyNo").val()
        /*gender: $("i.selected").attr("data-s"),*/
    });
    function  fsyzm() {
        $.ajax({
            async: false,
            type: "get",
            url: 'http://www.940.com/getPhoneCode?user_name=test1@sududa.com&password=111111&phone=18078818796',
            dataType: 'jsonp',
            data: modify,
            jsonp: 'callback',
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function(data) {
                data = formatData(data);
                console.log(modify);
                /*  console.log(data);*/
                if (data.status == 1) {
                    alert(data.tips);
                    // HTML5 LocalStorage 本地存储
                    var json = {"u":$(".login-user").val(),"password":$(".login-passw").val()};
                    // alert(JSON.stringify(json));
                    localStorage.member = JSON.stringify(json);//设置a为"3"
                    window.location.href = "user.html";
                } else if (data.status == -9) {
                    alert(data.tips);
                } else {
                    alert("data.tips");
                }
            }
        });
        /*            http://127.0.0.1:8088/getPhoneCode?user_name=test1@sududa.com&password=111111&phone=18078818796*/
    }
    $("#btn_part1").click(function(){
        if(!verifyCheck._click()) return;
        $(".step li").eq(1).addClass("on");
    });



    function formatData(r) {
        var a = new Array();
        var c = Object.prototype.toString.call(r);
        r = /String/.test(c) ? eval('(' + r +')') : r;
        var d = Object.prototype.toString.call(r);
        // console.log(d);   // [object Object]
        a = /Array/.test(d) ? r : a[0]=r;
        return a;
    }



    // 修改密码
    var ajaxPane = $('.verifyCheck');
    ajaxPane.bind('submit', function(event) {
        event.preventDefault();
        var modify = $.param({
            /* user_name: $(".passw-form .username").text(),*/
            phone:$("#phone").val(),
            code: $(".verifyNo").val()
            /*gender: $("i.selected").attr("data-s"),*/
        });
        $.ajax({
            async: false,
            type: "get",
            url: 'http://www.940.com/bindPhone',
            dataType: 'jsonp',
            data: modify,
            jsonp: 'callback',
            contentType: "application/x-www-form-urlencoded; charset=utf-8",
            success: function(data) {
                data = formatData(data);
                console.log(modify);
                /*  console.log(data);*/
                if (data.status == 1) {
                    alert(data.tips);
                    // HTML5 LocalStorage 本地存储
                    var json = {"u":$(".login-user").val(),"password":$(".login-passw").val()};
                    // alert(JSON.stringify(json));
                    localStorage.member = JSON.stringify(json);//设置a为"3"
                    window.location.href = "user.html";
                } else if (data.status == -9) {
                    alert(data.tips);
                } else {
                    alert("data.tips");
                }
            }
        });
    });

});
</script>
</body>
</html>
